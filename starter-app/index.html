<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://miro.com/app/static/sdk.1.1.js"></script>
    <script>

        function postData(endpoint, data) {
            fetch("https://hittatilltf.com/" + endpoint, {
                method: "POST",
                headers: {},
                body: JSON.stringify(data)
            }).then(res => {
                console.log(res.status)
            });
        };

        async function handleClickEvent(event) {
            console.log("click!")
            let board = await miro.board.info.get();
            let userId = await miro.currentUser.getId();
            let data = {
                type: "CLICK",
                board: board.id,
                user: userId
            };
            postData("add_event", data);
        };

        miro.onReady(() => {
            miro.addListener("CANVAS_CLICKED", handleClickEvent);
            console.log("kappa2");
            
            miro.initialize({
                extensionPoints: {
                    bottomBar: {
                        title: 'Analytics Toolkit',
                        svgIcon: '<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"></circle>',
                        onClick: () => {
                            console.log("lol");
                        },
                    },
                },
            })
        });
    </script>
</head>
</html>
